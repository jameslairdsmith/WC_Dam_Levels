mutate(ChangeInStorage=(Storage-lag(Storage))/Storage) %>%
arrange(ChangeInStorage) %>%
mutate(Month=month(Date)) %>%
ggplot(aes(x=Month,y=ChangeInStorage)) +
geom_boxplot(aes(group=Month)) +
scale_x_continuous(breaks = 1:12) +
scale_y_continuous(limits = c(-0.015,0.025)) +
ylab("Daily Change in Capacity")
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage))/Storage) %>%
arrange(ChangeInStorage) %>%
mutate(Month=month(Date)) %>%
ggplot(aes(x=Month,y=ChangeInStorage)) +
geom_boxplot(aes(group=Month)) +
scale_x_continuous(breaks = 1:12) +
scale_y_continuous(limits = c(-0.015,0.025)) +
ylab("Daily change in capacity")
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage))/Storage) %>%
arrange(ChangeInStorage) %>%
mutate(Month=month(Date)) %>%
ggplot(aes(x=Month,y=ChangeInStorage)) +
geom_boxplot(aes(group=Month)) +
scale_x_continuous(breaks = 1:12) +
scale_y_continuous(limits = c(-0.015,0.025)) +
ylab("Daily change in capacity (%)")
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
#mutate(Dam=str_replace_all(Dam,"[^[:alnum:]]", " ")) %>%
#mutate(Dam=str_replace_all(Dam,"Vo Lvlei", "Voelvlei")) %>%
#mutate(Dam=str_to_title(Dam)) %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage))/Storage) %>%
arrange(ChangeInStorage) %>%
mutate(Week=week(Date)) %>%
ggplot(aes(x=Week,y=ChangeInStorage)) +
geom_boxplot(aes(group=Week)) +
scale_x_continuous(breaks = 1:54) +
scale_y_continuous(limits = c(-0.015,0.025))
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=str_replace_all(Dam,"[^[:alnum:]]", " ")) %>%
mutate(Dam=str_replace_all(Dam,"Vo Lvlei", "Voelvlei")) %>%
mutate(Dam=str_to_title(Dam)) %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage,n = 365))) %>%
filter(!is.na(ChangeInStorage)) %>%
filter(Storage!=0) %>%
ggplot(aes(x=Date,y=ChangeInStorage))+
geom_line(na.rm = T)
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
#mutate(Dam=str_replace_all(Dam,"[^[:alnum:]]", " ")) %>%
#mutate(Dam=str_replace_all(Dam,"Vo Lvlei", "Voelvlei")) %>%
#mutate(Dam=str_to_title(Dam)) %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage,n = 365))) %>%
filter(!is.na(ChangeInStorage)) %>%
filter(Storage!=0) %>%
ggplot(aes(x=Date,y=ChangeInStorage))+
geom_line(na.rm = T)
#ggsave()
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
#theme_gray() +
guides(fill=guide_legend(title = "Dam"))
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam"))
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage))/Storage) %>%
arrange(ChangeInStorage) %>%
mutate(Week=week(Date)) %>%
ggplot(aes(x=Week,y=ChangeInStorage)) +
geom_boxplot(aes(group=Week)) +
scale_x_continuous(breaks = 1:54) +
scale_y_continuous(limits = c(-0.015,0.025))
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
#mutate(Dam=str_replace_all(Dam,"[^[:alnum:]]", " ")) %>%
#mutate(Dam=str_replace_all(Dam,"Vo Lvlei", "Voelvlei")) %>%
#mutate(Dam=str_to_title(Dam)) %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage,n = 365))) %>%
filter(!is.na(ChangeInStorage)) %>%
filter(Storage!=0) %>%
ggplot(aes(x=Date,y=ChangeInStorage))+
geom_line(na.rm = T)
#ggsave()
plot<-StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(DateDayMonth=make_date(1990, month(Date), day(Date))) %>%
group_by(DateDayMonth) %>%
mutate(AvrStorage=median(Storage,na.rm=T)) %>%
mutate(StorageDiff=(Storage-AvrStorage)) %>%
filter(!is.na(DateDayMonth)) %>%
filter(Storage!=0) %>%
#View()
ggplot(aes(x=Date,y=StorageDiff)) +
geom_line(na.rm = T) +
scale_x_date(date_breaks = "1 year",date_labels  = "%Y") +
scale_y_continuous(labels = function(x){x/1000}) +
ylab("Capacity difference from median at time of year ('000)")
#build<-ggplot_build(plot)
#as.date(build$layout$panel_ranges[[1]]$x.major_source)
plot +
theme_tufte() +
geom_rangeframe()+
scale_y_continuous(breaks = extended_range_breaks()(plot$data$StorageDiff),labels = function(x){round(x/1000,0)})
plot<-StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(DateDayMonth=make_date(1990, month(Date), day(Date))) %>%
group_by(DateDayMonth) %>%
mutate(AvrStorage=median(Storage,na.rm=T)) %>%
mutate(StorageDiff=(Storage-AvrStorage)) %>%
filter(!is.na(DateDayMonth)) %>%
filter(Storage!=0) %>%
#View()
ggplot(aes(x=Date,y=StorageDiff)) +
geom_line(na.rm = T) +
scale_x_date(date_breaks = "1 year",date_labels  = "%Y") +
scale_y_continuous(labels = function(x){x/1000}) +
ylab("Capacity difference from median at time of year ('000)")
#build<-ggplot_build(plot)
#as.date(build$layout$panel_ranges[[1]]$x.major_source)
plot +
#theme_tufte() +
#geom_rangeframe()+
scale_y_continuous(breaks = extended_range_breaks()(plot$data$StorageDiff),labels = function(x){round(x/1000,0)})
plot<-StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(DateDayMonth=make_date(1990, month(Date), day(Date))) %>%
group_by(DateDayMonth) %>%
mutate(AvrStorage=median(Storage,na.rm=T)) %>%
mutate(StorageDiff=(Storage-AvrStorage)) %>%
filter(!is.na(DateDayMonth)) %>%
filter(Storage!=0) %>%
#View()
ggplot(aes(x=Date,y=StorageDiff)) +
geom_line(na.rm = T) +
scale_x_date(date_breaks = "1 year",date_labels  = "%Y") +
scale_y_continuous(labels = function(x){x/1000}) +
ylab("Capacity difference from median at time of year ('000)")
#build<-ggplot_build(plot)
#as.date(build$layout$panel_ranges[[1]]$x.major_source)
#plot +
#theme_tufte() +
#geom_rangeframe()+
#scale_y_continuous(breaks = extended_range_breaks()(plot$data$StorageDiff),labels = function(x){round(x/1000,0)})
#scale_x_date(breaks=)
#scale_x_date(breaks = range(plot$data$Date,na.rm = T))
#geom_hline(yintercept = 0)
#Dates<-plot$data %>%
#  ungroup() %>%
#  select(Date) %>%
#  as.list()
#pretty_dates(Dates,5)
plot<-StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(DateDayMonth=make_date(1990, month(Date), day(Date))) %>%
group_by(DateDayMonth) %>%
mutate(AvrStorage=median(Storage,na.rm=T)) %>%
mutate(StorageDiff=(Storage-AvrStorage)) %>%
filter(!is.na(DateDayMonth)) %>%
filter(Storage!=0) %>%
#View()
ggplot(aes(x=Date,y=StorageDiff)) +
geom_line(na.rm = T) +
scale_x_date(date_breaks = "1 year",date_labels  = "%Y") +
scale_y_continuous(labels = function(x){x/1000}) +
ylab("Capacity difference from median at time of year ('000)")
#build<-ggplot_build(plot)
#as.date(build$layout$panel_ranges[[1]]$x.major_source)
#plot +
#theme_tufte() +
#geom_rangeframe()+
#scale_y_continuous(breaks = extended_range_breaks()(plot$data$StorageDiff),labels = function(x){round(x/1000,0)})
#scale_x_date(breaks=)
#scale_x_date(breaks = range(plot$data$Date,na.rm = T))
#geom_hline(yintercept = 0)
#Dates<-plot$data %>%
#  ungroup() %>%
#  select(Date) %>%
#  as.list()
#pretty_dates(Dates,5)
plot
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(DateDayMonth=make_date(1990, month(Date), day(Date))) %>%
group_by(DateDayMonth) %>%
mutate(AvrStorage=median(Storage,na.rm=T)) %>%
mutate(StorageDiff=(Storage-AvrStorage)) %>%
filter(!is.na(DateDayMonth)) %>%
filter(Storage!=0) %>%
#View()
ggplot(aes(x=Date,y=StorageDiff)) +
geom_line(na.rm = T) +
scale_x_date(date_breaks = "1 year",date_labels  = "%Y") +
scale_y_continuous(labels = function(x){x/1000}) +
ylab("Capacity difference from median at time of year ('000)")
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage))/Storage) %>%
arrange(ChangeInStorage) %>%
mutate(Month=month(Date)) %>%
ggplot(aes(x=Month,y=ChangeInStorage)) +
geom_boxplot(aes(group=Month)) +
scale_x_continuous(breaks = 1:12) +
scale_y_continuous(limits = c(-0.015,0.025),labels = scales::percent) +
ylab("Daily change in capacity (%)")
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage))/Storage) %>%
arrange(ChangeInStorage) %>%
mutate(Month=month(Date)) %>%
ggplot(aes(x=Month,y=ChangeInStorage)) +
geom_boxplot(aes(group=Month)) +
scale_x_continuous(breaks = 1:12) +
scale_y_continuous(limits = c(-0.015,0.025),labels = scales::percent) +
ylab("Daily change in capacity")
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage))/Storage) %>%
arrange(ChangeInStorage) %>%
mutate(Month=month(Date)) %>%
ggplot(aes(x=Month,y=ChangeInStorage)) +
geom_boxplot(aes(group=Month)) +
scale_x_continuous(breaks = 1:12) +
scale_y_continuous(limits = c(-0.015,0.025),labels = scales::percent) +
ylab("Daily change in capacity of 'Big Six' dams")
StorageLong %>%
arrange(desc(Capacity)) %>%
ungroup() %>%
mutate(Dam=fct_lump(fct_rev(fct_reorder(Dam,Capacity)),n=6,ties.method = "first")) %>%
filter(Dam!="Other") %>%
group_by(Date) %>%
summarise(Storage=sum(Storage,na.rm=T)) %>%
mutate(ChangeInStorage=(Storage-lag(Storage))/Storage) %>%
arrange(ChangeInStorage) %>%
mutate(Month=month(Date)) %>%
ggplot(aes(x=Month,y=ChangeInStorage)) +
geom_boxplot(aes(group=Month)) +
scale_x_continuous(breaks = 1:12) +
scale_y_continuous(limits = c(-0.015,0.025),labels = scales::percent) +
ylab("Daily change in capacity (Big Six)")
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam"))+
theme(legend.position="top")
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam")) +
theme(legend.position="top")
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam"))
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam"))
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam"))
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam"))
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam"))
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam"))
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam"))
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T)) %>%
ungroup() %>%
ggplot() +
geom_area(aes(x=Date,y=PercentTotalCapacity,fill=Dam_Other),position = "stack") +
scale_fill_grey() +
scale_y_continuous(labels = scales::percent) +
scale_x_date(date_breaks =  "1 year",date_labels = "%Y") +
ylab("Percent Capacity") +
guides(fill=guide_legend(title = "Dam"))
StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T))
SeasonalMonthData<-StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T))
#SeasonalMonthData
SeasonalMonthData %>%
head(10) %>%
kable()
SeasonalMonthData<-StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T))
write.csv(SeasonalMonthData,file="Data/SeasonalMonthData.csv")
SeasonalMonthData %>%
head(10) %>%
kable()
SeasonalMonthData<-StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T))
write.csv(SeasonalMonthData,file="Data/SeasonalMonthData.csv")
SeasonalMonthData %>%
head(10) %>%
kable()
SeasonalMonthData<-StorageLong %>%
mutate(Dam_Other=fct_lump(fct_reorder(Dam,Capacity,.desc = T),6,ties.method = "first")) %>%
mutate(Year=year(Date),Month=month(Date)) %>%
group_by(Dam,Year,Month,Dam_Other,Capacity) %>%
summarise(PercentTotalCapacity=median(PercentTotalCapacity,na.rm=T),Date=median(Date,na.rm=T))
write.csv(SeasonalMonthData,file="Data/SeasonalMonthData.csv")
SeasonalMonthData %>%
head(10) %>%
kable()
